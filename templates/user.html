{{define "title"}}@{{.User.Login}} — InReview{{end}}

{{define "content"}}
<div class="page-wrap">

  <!-- ── User Header ── -->
  <div class="user-header">
    {{if .User.AvatarURL}}
    <img src="{{.User.AvatarURL}}" class="user-avatar" alt="@{{.User.Login}}" />
    {{end}}
    <div class="user-info">
      <h1 class="page-title">
        {{if .User.Name}}{{.User.Name}}{{else}}@{{.User.Login}}{{end}}
      </h1>
      <p class="user-login mono">@{{.User.Login}}</p>
      {{if .User.Bio}}<p class="user-bio">{{.User.Bio}}</p>{{end}}
      <div class="user-meta">
        {{if .User.Company}}<span class="meta-item">{{.User.Company}}</span>{{end}}
        {{if .User.Location}}<span class="meta-item">{{.User.Location}}</span>{{end}}
        {{if .User.Followers}}<span class="meta-item">{{formatNumber .User.Followers}} followers</span>{{end}}
        {{if .User.PublicRepos}}<span class="meta-item">{{.User.PublicRepos}} repos</span>{{end}}
      </div>
    </div>
    <a href="https://github.com/{{.User.Login}}" target="_blank" rel="noopener" class="btn btn-outline">GitHub ↗</a>
  </div>

  <!-- ── Global Ranks ── -->
  {{if or .ReviewerRank .GatekeeperRank}}
  <div class="rank-banner">
    {{if .ReviewerRank}}
    <div class="rank-pill">
      <span class="rank-pill-icon">TOP</span>
      <span>#{{.ReviewerRank}} Reviewer</span>
      <span class="rank-pill-sub">globally</span>
    </div>
    {{end}}
    {{if .GatekeeperRank}}
    <div class="rank-pill warn">
      <span class="rank-pill-icon">GATE</span>
      <span>#{{.GatekeeperRank}} Gatekeeper</span>
      <span class="rank-pill-sub">globally</span>
    </div>
    {{end}}
  </div>
  {{end}}

  <!-- ── Two-column stats ── -->
  <div class="two-col">

    <!-- As Reviewer -->
    <div class="col-card">
      <h2 class="col-title">As a Reviewer</h2>
      {{if .ReviewerStats}}
      {{with .ReviewerStats}}
      <div class="col-stats">
        <div class="col-stat">
          <span class="col-stat-num">{{formatNumber .TotalReviews}}</span>
          <span class="col-stat-label">Total Reviews</span>
        </div>
        <div class="col-stat">
          <span class="col-stat-num green">{{formatNumber .Approvals}}</span>
          <span class="col-stat-label">Approvals</span>
        </div>
        <div class="col-stat">
          <span class="col-stat-num warn">{{formatNumber .ChangesRequested}}</span>
          <span class="col-stat-label">Changes Requested</span>
        </div>
        <div class="col-stat">
          <span class="col-stat-num muted">{{formatNumber .Comments}}</span>
          <span class="col-stat-label">Comments</span>
        </div>
      </div>

      {{if gt .TotalReviews 0}}
      <div class="approval-bar-wrap">
        <div class="approval-bar">
          <div class="approval-fill" style="width:{{percent .Approvals .TotalReviews}}%"></div>
        </div>
        <span class="approval-label">{{percent .Approvals .TotalReviews}}% approval rate</span>
      </div>
      {{end}}
      {{end}}
      {{else}}
      <p class="col-empty">No review data yet for this user.</p>
      {{end}}
    </div>

    <!-- As Author -->
    <div class="col-card">
      <h2 class="col-title">As an Author</h2>
      {{if .AuthorStats}}
      {{with .AuthorStats}}
      <div class="col-stats">
        <div class="col-stat">
          <span class="col-stat-num">{{formatNumber .MergedPRs}}</span>
          <span class="col-stat-label">Merged PRs</span>
        </div>
        <div class="col-stat">
          <span class="col-stat-num">{{formatNumber .TotalPRs}}</span>
          <span class="col-stat-label">Total PRs</span>
        </div>
        <div class="col-stat">
          <span class="col-stat-num speed">{{formatDuration .AvgMergeTimeSecs}}</span>
          <span class="col-stat-label">Avg Merge Time</span>
        </div>
        {{if gt .TotalPRs 0}}
        <div class="col-stat">
          <span class="col-stat-num">{{percent .MergedPRs .TotalPRs}}%</span>
          <span class="col-stat-label">Merge Rate</span>
        </div>
        {{end}}
      </div>
      {{end}}
      {{else}}
      <p class="col-empty">No PR author data yet for this user.</p>
      {{end}}
    </div>

  </div><!-- /two-col -->

  <!-- ── Popular Repos ── -->
  {{if .PopularRepos}}
  <section class="section">
    <h2 class="section-title">Active Repos</h2>
    <div class="repo-chips">
      {{range .PopularRepos}}
      <a href="/repo/{{.FullName}}" class="repo-chip">
        <span class="repo-chip-name mono">{{.FullName}}</span>
        {{if .MergedPRCount}}
        <span class="repo-chip-stat">{{.MergedPRCount}} PRs · {{formatDuration .AvgMergeTimeSecs}} avg</span>
        {{end}}
      </a>
      {{end}}
    </div>
  </section>
  {{end}}

</div>
{{end}}
